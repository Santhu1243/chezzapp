<form method="post" action="{% url 'nonsap:update_priority' issue.id %}">
    {% csrf_token %}
    <div class="form-group d-md-flex ">
      
        <div class="col-md-9 col-sm-12">
            <select id="priority" name="priority" class="form-control">
                <option value="p1" {% if issue.priority == 'p1' %}selected{% endif %}>P1 (Resolve in 1 day)</option>
                <option value="p2" {% if issue.priority == 'p2' %}selected{% endif %}>P2 (Resolve in 3 days)</option>
                <option value="p3" {% if issue.priority == 'p3' %}selected{% endif %}>P3 (Resolve in 6-7 days)</option>
                <option value="p4" {% if issue.priority == 'p4' %}selected{% endif %}>P4 (Custom)</option>
            </select>
        </div>
    </div>

    

   

    <!-- Submit Button -->
    <button type="submit" class="btn btn-primary mt-4">Update Priority</button>
</form>

<script>
    $(document).ready(function () {
        function calculateResolutionDate(daysToAdd) {
            let currentDate = new Date();
            currentDate.setDate(currentDate.getDate() + daysToAdd);

            let day = currentDate.getDate();
            let month = currentDate.getMonth() + 1; // Months are zero-based
            let year = currentDate.getFullYear();

            return (day < 10 ? '0' : '') + day + '/' + (month < 10 ? '0' : '') + month + '/' + year;
        }

        function updateResolutionDate() {
            let priority = $('#priority').val();
            let daysToAdd;

            if (priority === "p1") daysToAdd = 1;
            else if (priority === "p2") daysToAdd = 3;
            else if (priority === "p3") daysToAdd = 6;
            else if (priority === "p4") {
                let daysValue = parseInt($('#days').val());
                daysToAdd = isNaN(daysValue) ? 0 : daysValue;
            }

            $('#resolutionDate').val(calculateResolutionDate(daysToAdd));
        }

        // Update days input field based on priority
        $('#priority').change(function () {
            let priority = $(this).val();

            if (priority === "p4") {
                $('#days').prop("disabled", false);
            } else {
                $('#days').prop("disabled", true);
                $('#days').val(priority === "p1" ? 1 : priority === "p2" ? 3 : 6);
            }

            updateResolutionDate();
        });

        // Update resolution date when custom days are entered
        $('#days').on('input', function () {
            updateResolutionDate();
        });

        // Set initial resolution date
        updateResolutionDate();
    });
</script>
